<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="Study Hub ‚Äî your gateway to unlimited learning."
    />
    <title>Study Hub ‚Äî Learning Portal</title>

    <!-- Preloads -->
    <link rel="preload" href="/" as="document" />
    <link rel="preload" href="/sw-cache.js" as="script" />
    <link rel="preload" href="/index.html" as="document" />

    <!-- Icon (kept inline for simplicity) -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>"
    />

    <style>
      /* Critical CSS (kept in-head for fast first paint) */
      :root {
        --primary: #667eea;
        --secondary: #764ba2;
        --bg-dark-1: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        --glass: rgba(255, 255, 255, 0.12);
        --text: #ffffff;
        --muted: rgba(255, 255, 255, 0.85);
      }
      [data-theme="light"] {
        --bg-dark-1: linear-gradient(135deg, #f3f4f6 0%, #e9d5ff 100%);
        --glass: rgba(0, 0, 0, 0.06);
        --text: #111827;
        --muted: rgba(17, 24, 39, 0.9);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
        background: var(--bg-dark-1);
        color: var(--text);
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
        position: relative;
        z-index: 2;
      }
      header {
        text-align: center;
        padding: 36px 8px;
      }
      .logo {
        font-size: 4rem;
      }
      h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(45deg, #fff, #e0e0e0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .tagline {
        opacity: 0.95;
        margin-top: 6px;
        color: var(--muted);
      }
      .main-box {
        margin-top: 22px;
        background: var(--glass);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        border-radius: 18px;
        padding: 28px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .input-group {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      #urlInput {
        flex: 1;
        padding: 18px 20px;
        border-radius: 12px;
        border: none;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.95);
        color: #222;
      }
      .btn {
        padding: 14px 20px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }
      .engines {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 14px;
        flex-wrap: wrap;
      }
      .engine-btn {
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: transparent;
        color: var(--text);
        cursor: pointer;
        font-weight: 700;
      }
      .engine-btn.active {
        background: #fff;
        color: var(--primary);
      }
      .proxy-container {
        display: none;
        margin-top: 18px;
      }
      .proxy-container.active {
        display: block;
      }
      #proxyFrame {
        width: 100%;
        height: 70vh;
        border: none;
        border-radius: 12px;
        background: white;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      }
      .toolbar {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 12px;
      }
      .tool-btn {
        padding: 10px 12px;
        border-radius: 10px;
        border: none;
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        cursor: pointer;
      }
      .quick-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 14px;
        margin-top: 18px;
      }
      .quick-link {
        padding: 18px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.06);
        text-align: center;
        cursor: pointer;
      }
      .settings-box {
        margin-top: 18px;
        padding: 16px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.04);
      }
      footer {
        text-align: center;
        margin-top: 28px;
        padding: 18px;
        color: var(--muted);
      }
      .status {
        padding: 10px 14px;
        border-radius: 10px;
        margin: 12px 0;
        display: none;
      }
      .status.show {
        display: block;
      }
      .status.loading {
        background: rgba(255, 152, 0, 0.12);
        border: 1px solid rgba(255, 152, 0, 0.2);
      }
      .status.success {
        background: rgba(76, 175, 80, 0.12);
        border: 1px solid rgba(76, 175, 80, 0.2);
      }
      .status.error {
        background: rgba(244, 67, 54, 0.12);
        border: 1px solid rgba(244, 67, 54, 0.2);
      }
      /* small helpers */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      @media (max-width: 768px) {
        h1 {
          font-size: 1.8rem;
        }
        .logo {
          font-size: 2.6rem;
        }
        .input-group {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" id="app">
      <header>
        <div class="logo">üöÄ</div>
        <h1>Study Hub</h1>
        <p class="tagline">Your Gateway to Unlimited Learning</p>
      </header>

      <main class="main-box" role="main">
        <div class="input-group" aria-label="Search or URL input">
          <input
            id="urlInput"
            placeholder="Enter website URL or search..."
            autocomplete="off"
            aria-label="Enter URL or search term"
          />
          <button class="btn" id="goBtn">üî• GO</button>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>

        <div class="engines" role="tablist" aria-label="Search engines">
          <button class="engine-btn active" data-engine="google">Google</button>
          <button class="engine-btn" data-engine="bing">Bing</button>
          <button class="engine-btn" data-engine="duckduckgo">
            DuckDuckGo
          </button>
          <button class="engine-btn" data-engine="brave">Brave</button>
        </div>

        <div class="proxy-container" id="proxyContainer" aria-hidden="true">
          <div class="toolbar" role="toolbar">
            <button class="tool-btn" id="backBtn">‚Üê Back</button>
            <button class="tool-btn" id="forwardBtn">Forward ‚Üí</button>
            <button class="tool-btn" id="reloadBtn">üîÑ Reload</button>
            <button class="tool-btn" id="homeBtn">üè† Home</button>
            <button class="tool-btn" id="fullscreenBtn">‚õ∂ Fullscreen</button>
          </div>
          <iframe
            id="proxyFrame"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"
            title="Proxy Frame"
          ></iframe>
        </div>

        <div class="quick-links" id="quickLinks">
          <div class="quick-link" data-url="https://www.youtube.com">
            üì∫ YouTube
          </div>
          <div class="quick-link" data-url="https://discord.com/app">
            üí¨ Discord
          </div>
          <div class="quick-link" data-url="https://www.reddit.com">
            üì± Reddit
          </div>
          <div class="quick-link" data-url="https://twitter.com">
            üê¶ X / Twitter
          </div>
          <div class="quick-link" data-url="https://www.twitch.tv">
            üéÆ Twitch
          </div>
          <div class="quick-link" data-url="https://www.github.com">
            üíª GitHub
          </div>
        </div>

        <div class="settings-box" aria-label="Settings">
          <label
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 12px;
            "
          >
            <span>üé≠ Tab Cloaking</span>
            <button id="cloakToggle" aria-pressed="false" class="tool-btn">
              Toggle
            </button>
          </label>
          <label
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-top: 10px;
              gap: 12px;
            "
          >
            <span>üîí Panic Key (ESC)</span>
            <button id="panicToggle" aria-pressed="true" class="tool-btn">
              Enabled
            </button>
          </label>
          <label
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-top: 10px;
              gap: 12px;
            "
          >
            <span>‚òÄÔ∏è Theme</span>
            <select
              id="themeSelect"
              class="tool-btn"
              aria-label="Theme selector"
            >
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </label>
        </div>
      </main>

      <footer>
        <p>
          Built with üíú for Students ‚Äî Use responsibly ‚Ä¢ Educational purposes
          only
        </p>
      </footer>
    </div>

    <!-- Load minimal runtime (deferred) -->
    <script>
      // Minimal runtime: handles navigation, proxy framing, settings, keyboard shortcuts.
      (function () {
        const engines = {
          google: "https://www.google.com/search?q=",
          bing: "https://www.bing.com/search?q=",
          duckduckgo: "https://duckduckgo.com/?q=",
          brave: "https://search.brave.com/search?q=",
        };
        const urlInput = document.getElementById("urlInput");
        const status = document.getElementById("status");
        const proxyContainer = document.getElementById("proxyContainer");
        const proxyFrame = document.getElementById("proxyFrame");
        const quickLinks = document.getElementById("quickLinks");
        const themeSelect = document.getElementById("themeSelect");
        let currentEngine = "google";
        let panicEnabled = true;
        let cloakEnabled = false;
        let currentUrl = "";

        function showStatus(msg, type = "") {
          status.textContent = msg;
          status.className = "status show " + type;
          if (type !== "loading")
            setTimeout(() => status.classList.remove("show"), 4000);
        }

        document.querySelectorAll(".engine-btn").forEach((b) => {
          b.addEventListener("click", () => {
            document
              .querySelectorAll(".engine-btn")
              .forEach((x) => x.classList.remove("active"));
            b.classList.add("active");
            currentEngine = b.dataset.engine;
          });
        });

        function resolveInput(input) {
          input = input.trim();
          if (!input) return "";
          if (/^https?:\/\//i.test(input)) return input;
          if (input.includes(".") && !input.includes(" "))
            return "https://" + input;
          return engines[currentEngine] + encodeURIComponent(input);
        }

        function loadProxy(url) {
          if (!url) return;
          showStatus("üîÑ Loading...", "loading");
          // Use internal worker proxy: /proxy?url=ENCODED (deployed separately if you choose)
          const workerProxy = "/cdn-cgi/rum?url=" + encodeURIComponent(url); // fallback non-proxy path to avoid 3rd-party dependence
          // Prefer deploying worker-proxy.js to support /proxy?url=...
          proxyFrame.src = "/proxy?url=" + encodeURIComponent(url);
          proxyContainer.classList.add("active");
          quickLinks.style.display = "none";
          proxyContainer.setAttribute("aria-hidden", "false");
        }

        document.getElementById("goBtn").addEventListener("click", () => {
          const value = urlInput.value;
          const url = resolveInput(value);
          currentUrl = url;
          loadProxy(url);
        });

        urlInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") document.getElementById("goBtn").click();
        });

        document.getElementById("backBtn").addEventListener("click", () => {
          try {
            proxyFrame.contentWindow.history.back();
          } catch (e) {
            showStatus("‚ö†Ô∏è Cannot go back in iframe", "error");
          }
        });
        document.getElementById("forwardBtn").addEventListener("click", () => {
          try {
            proxyFrame.contentWindow.history.forward();
          } catch (e) {
            showStatus("‚ö†Ô∏è Cannot go forward in iframe", "error");
          }
        });
        document.getElementById("reloadBtn").addEventListener("click", () => {
          showStatus("üîÑ Reloading...", "loading");
          proxyFrame.src = proxyFrame.src;
        });
        document.getElementById("homeBtn").addEventListener("click", () => {
          proxyContainer.classList.remove("active");
          quickLinks.style.display = "grid";
          proxyContainer.setAttribute("aria-hidden", "true");
          urlInput.value = "";
          status.classList.remove("show");
        });
        document
          .getElementById("fullscreenBtn")
          .addEventListener("click", () => {
            if (proxyFrame.requestFullscreen) proxyFrame.requestFullscreen();
          });

        quickLinks.querySelectorAll(".quick-link").forEach((el) => {
          el.addEventListener("click", () => {
            urlInput.value = el.dataset.url;
            document.getElementById("goBtn").click();
          });
        });

        // Cloak toggle
        document.getElementById("cloakToggle").addEventListener("click", () => {
          cloakEnabled = !cloakEnabled;
          if (cloakEnabled) {
            document.title = "Classes";
            showStatus("üé≠ Tab cloaking enabled", "success");
          } else {
            document.title = "Study Hub ‚Äî Learning Portal";
            showStatus("üé≠ Tab cloaking disabled", "success");
          }
        });

        // Panic toggle
        const panicBtn = document.getElementById("panicToggle");
        panicBtn.addEventListener("click", () => {
          panicEnabled = !panicEnabled;
          panicBtn.textContent = panicEnabled ? "Enabled" : "Disabled";
          panicBtn.setAttribute("aria-pressed", String(panicEnabled));
          showStatus(
            panicEnabled ? "üîí Panic key enabled" : "üîí Panic key disabled",
            "success"
          );
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && panicEnabled) {
            window.location.href = "https://classroom.google.com";
          }
        });

        // Theme handling
        themeSelect.addEventListener("change", () => {
          document.documentElement.setAttribute(
            "data-theme",
            themeSelect.value
          );
          localStorage.setItem("studyhub-theme", themeSelect.value);
        });
        const savedTheme = localStorage.getItem("studyhub-theme");
        if (savedTheme) {
          themeSelect.value = savedTheme;
          document.documentElement.setAttribute("data-theme", savedTheme);
        }

        // Service worker registration (safer registration with versioning)
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker
            .register("/sw-cache.js?v=1.0.0")
            .then(() => {
              console.log("Service worker registered (enhanced)");
            })
            .catch((err) => {
              console.warn("SW registration failed", err);
            });
        }

        // Restore last visited
        window.addEventListener("load", () => {
          const last = localStorage.getItem("studyhub-lastUrl");
          if (last) urlInput.value = last;
        });
        window.addEventListener("beforeunload", () => {
          if (currentUrl) localStorage.setItem("studyhub-lastUrl", currentUrl);
        });
      })();
    </script>
  </body>
</html>
